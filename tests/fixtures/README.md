# Test Fixtures

This directory contains test fixture data for the ferro-hgvs test suite.

## Git LFS Files

The following large fixtures are tracked with [Git LFS](https://git-lfs.github.com/).
After cloning, run `git lfs pull` to download them.

### `bulk/clinvar_hgvs_500k.json.gz` (~17 MB)

500K stratified sample of ClinVar HGVS variants.

- **Source:** [ClinVar hgvs4variation.txt.gz](https://ftp.ncbi.nlm.nih.gov/pub/clinvar/tab_delimited/hgvs4variation.txt.gz)
- **Generation:** Extracted via `ferro-benchmark extract clinvar`, then stratified-sampled to 500K variants across coordinate types
- **Used by:** `tests/clinvar_hgvs_tests.rs`

### `bulk/clinvar_hgvs_unique.json.gz` (~63 MB)

All unique ClinVar HGVS variants (~4.2M).

- **Source:** [ClinVar hgvs4variation.txt.gz](https://ftp.ncbi.nlm.nih.gov/pub/clinvar/tab_delimited/hgvs4variation.txt.gz)
- **Generation:** Extracted via `ferro-benchmark extract clinvar` with deduplication
- **Used by:** `tests/clinvar_hgvs_tests.rs`

### `validation/cmrg_genes_exhaustive.json.gz` (~63 MB)

All ClinVar variants for the 273 [GIAB CMRG](https://ftp.ncbi.nlm.nih.gov/pub/dbVar/data/Homo_sapiens/by_study/genotype/nstd232/) (Challenging Medically Relevant Genes) gene list (~4.8M variants).

- **Source:** ClinVar hgvs4variation.txt.gz filtered by GIAB CMRG v1.00 gene list
- **Reference:** [Wagner et al. (2022)](https://pubmed.ncbi.nlm.nih.gov/35132260/) - PMID 35132260
- **Used by:** `tests/cmrg_exhaustive_tests.rs`

### `validation/paraphase_genes_exhaustive.json.gz` (~5.7 MB)

All ClinVar variants for 35 genes with segmental duplications supported by [Paraphase](https://github.com/PacificBiosciences/paraphase) (~435K variants).

- **Source:** ClinVar hgvs4variation.txt.gz filtered by Paraphase gene list
- **Genes include:** SMN1/SMN2, CYP21A2, TNXB, C4A/C4B, PMS2, STRC, IKBKG, NEB, F8, GBA, HBA1/HBA2, and others
- **Used by:** `tests/paraphase_exhaustive_tests.rs`

## Regenerating LFS Fixtures

All LFS fixtures derive from the ClinVar hgvs4variation file.

### 1. Download source data

```bash
curl -o hgvs4variation.txt.gz \
  https://ftp.ncbi.nlm.nih.gov/pub/clinvar/tab_delimited/hgvs4variation.txt.gz
```

This file is ~461 MB and updated monthly by NCBI.

### 2. Extract patterns

Build the benchmark tool and use it to extract patterns:

```bash
cargo build --release --features benchmark
ferro-benchmark extract clinvar -i hgvs4variation.txt.gz -o patterns.txt
```

The extraction reads columns 6 (NucleotideExpression) and 8 (ProteinExpression) from the ClinVar TSV, deduplicates, and outputs unique HGVS patterns.

### 3. Generate fixture files

The gene-filtered exhaustive fixtures (CMRG and Paraphase) are generated by filtering the extracted patterns against their respective gene lists. See `src/benchmark/extract.rs` for the filtering logic.

## Also Available (Not Tracked)

### `bulk/hgvs4variation.txt.gz` (~461 MB)

The complete ClinVar HGVS file. Too large to track in LFS. Download directly:

```bash
curl -o tests/fixtures/bulk/hgvs4variation.txt.gz \
  https://ftp.ncbi.nlm.nih.gov/pub/clinvar/tab_delimited/hgvs4variation.txt.gz
```

Used by `tests/clinvar_validation.rs` (requires `--features slow-tests`):

```bash
cargo test --release --features slow-tests test_clinvar_validation -- --nocapture
```

## Non-LFS Fixtures

Smaller fixtures (<1 MB) are tracked directly in git. Key categories:

- **`grammar/`** — HGVS parsing test cases from the official spec, mutalyzer, and biocommons
- **`normalization/`** — Normalization test cases with expected outputs
- **`validation/`** — ClinVar, dbSNP, and VariantValidator validation sets
- **`external/`** — Patterns extracted from external tools (VEP, SnpEff, MaveDB)
- **`edge_cases/`** — Protein notation, reference sequences, and unusual notation
- **`bulk/`** — gnomAD constrained genes and ClinVar bulk samples (skippable if missing)
- **`sequences/`** — Mock transcript sequences for normalization tests
- **`transcripts/`** — Mock transcript metadata

See `SCHEMAS.md` for JSON format documentation.
